(() => {
  const imageURL = prompt("Enter your pixel image URL:");
  if (!imageURL) return;

  const container = document.createElement('div');
  container.style = `
    position: fixed;
    top: 100px;
    left: 100px;
    width: auto;
    height: auto;
    background: transparent;
    z-index: 9999;
    cursor: move;
    user-select: none;
  `;
  container.id = 'pixelOverlayWindow';

  const img = document.createElement('img');
  img.src = imageURL;
  img.style = `
    image-rendering: pixelated;
    transform-origin: top left;
    transform: scale(1);
    pointer-events: none;
    display: block;
  `;
  container.appendChild(img);

  const controls = document.createElement('div');
  controls.style = `
    position: absolute;
    top: -30px;
    left: 0;
    background: rgba(0,0,0,0.7);
    color: #fff;
    font-family: sans-serif;
    font-size: 12px;
    padding: 4px 6px;
    border-radius: 4px;
    display: flex;
    gap: 8px;
    align-items: center;
  `;
  controls.innerHTML = `
    <label>Scale <input type="range" min="0.1" max="10" step="0.1" value="1" id="scaleSlider"></label>
    <label>Opacity <input type="range" min="0.1" max="1" step="0.05" value="1" id="opacitySlider"></label>
    <button id="closeOverlay" style="margin-left:auto;">âœ–</button>
  `;
  container.appendChild(controls);
  document.body.appendChild(container);

  // Drag logic
  let isDragging = false, offsetX = 0, offsetY = 0;
  container.addEventListener('mousedown', e => {
    if (e.target.closest('input') || e.target.tagName === 'BUTTON') return;
    isDragging = true;
    offsetX = e.clientX - container.offsetLeft;
    offsetY = e.clientY - container.offsetTop;
    container.style.cursor = 'grabbing';
  });
  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    container.style.left = `${e.clientX - offsetX}px`;
    container.style.top = `${e.clientY - offsetY}px`;
  });
  document.addEventListener('mouseup', () => {
    isDragging = false;
    container.style.cursor = 'move';
  });

  // Controls
  document.getElementById('scaleSlider').addEventListener('input', e => {
    const scale = parseFloat(e.target.value);
    img.style.transform = `scale(${scale})`;
  });
  document.getElementById('opacitySlider').addEventListener('input', e => {
    container.style.opacity = e.target.value;
  });
  document.getElementById('closeOverlay').addEventListener('click', () => {
    container.remove();
  });
})();
