(function () {
  // UI setup
  const ui = document.createElement('div');
  ui.style = `
    position:fixed; top:10px; left:10px; background:#fff; padding:10px;
    border:1px solid #ccc; z-index:9999; font-family:sans-serif;
  `;
  ui.innerHTML = `
    <label>Image URL: <input type="text" id="imgUrl" style="width:200px;"></label><br>
    <label>Start X: <input type="number" id="startX" value="0" style="width:60px;"></label>
    <label>Start Y: <input type="number" id="startY" value="0" style="width:60px;"></label><br>
    <button id="startBtn">Start</button>
  `;
  document.body.appendChild(ui);

  document.getElementById('startBtn').onclick = () => {
    const url = document.getElementById('imgUrl').value;
    const startX = parseInt(document.getElementById('startX').value);
    const startY = parseInt(document.getElementById('startY').value);
    const img = new Image();
    img.crossOrigin = "Anonymous";

    img.onload = () => {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);

      const data = ctx.getImageData(0, 0, img.width, img.height).data;
      const pixels = [];

      for (let y = 0; y < img.height; y++) {
        for (let x = 0; x < img.width; x++) {
          const i = (y * img.width + x) * 4;
          const alpha = data[i + 3];
          if (alpha > 0) {
            pixels.push({ x: startX + x, y: startY + y });
          }
        }
      }

      const wplaceCanvas = document.querySelector('canvas');
      if (!wplaceCanvas) {
        alert("‚ùå WPlace canvas not found.");
        return;
      }

      let i = 0;
      function clickNext() {
        if (i >= pixels.length) {
          console.log("‚úÖ Done clicking all pixels.");
          return;
        }

        const { x, y } = pixels[i];
        const rect = wplaceCanvas.getBoundingClientRect();
        const clientX = rect.left + x;
        const clientY = rect.top + y;

        const clickEvent = new MouseEvent('click', {
          bubbles: true,
          cancelable: true,
          clientX,
          clientY
        });

        wplaceCanvas.dispatchEvent(clickEvent);
        console.log(`üñ±Ô∏è Clicked (${x}, ${y})`);
        i++;
        setTimeout(clickNext, 5000); // 5s cooldown
      }

      clickNext();
    };

    img.onerror = () => alert("‚ùå Failed to load image.");
    img.src = url;
  };
})();
